<!DOCTYPE html>
<html>
    <head>
        <meta charset='utf-8'>
        <style>
.q0-9 { fill:rgb(247,251,255); }
.q1-9 { fill:rgb(222,235,247); }
.q2-9 { fill:rgb(198,219,239); }
.q3-9 { fill:rgb(158,202,225); }
.q4-9 { fill:rgb(107,174,214); }
.q5-9 { fill:rgb(66,146,198); }
.q6-9 { fill:rgb(33,113,181); }
.q7-9 { fill:rgb(8,81,156); }
.q8-9 { fill:rgb(8,48,107); }
        </style>
    <body>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/1.6.19/topojson.min.js"></script>
        <script>
/**
var myData = [
    ['W28',3223534]
    ,['W12',234255]
    ,['W11',2352332]
    ,['W10',563452]
    ,['W9',234]
    ,['W8',563432]
    ,['W27',23455]
    ,['W24',462342]
    ,['W23',978465]
    ,['W21',67456]
    ,['W26',1232543]
    ,['W25',764343]
]
;
**/

// create map

var width = 700,
    height = 1000;

// dynamic color coding based on http://bl.ocks.org/mbostock/4060606
var resultsById = d3.map(
    [
        { id: "W28" }
        , { id: "W12" }
    ], function(d) {
        return d.id;
    }
); 
// What is d3.map() doing? 
/* https://github.com/mbostock/d3/wiki/Arrays#maps
 * This is not a geographical map but like a key value store
 */

// [OPEN] figure out how to properly add the measures to the map
resultsById.set('W28', 1123433);
resultsById.set('W12', 3223534);

var quantize = d3.scale.quantize()
    .domain([234, 3223534]) // [OPEN] set to min and max of the data set -- try to get this dynamic
    .range(d3.range(9).map(function(i) { return "q" + i + "-9"; }))
    // Note 9 define in the range() function relates to the 9 CSS styles we have defined
    ;

var projection = d3.geo.albers()
    //.center([0, 55.4])
    .center([3, 54])
    .rotate([4.4, 0])
    .parallels([50, 60])
    .scale(4000)
    .translate([width / 2, height / 2])
    //.translate(200,200)
    ;

var path = d3.geo.path()
    .projection(projection);

var svg = d3.select('body').append('svg')
    .attr('width', width)
    .attr('height', height);

d3.json('data/constituencies.topo.json', function(error, topology) {
    // create a polygon for every constituency
    svg.selectAll('.constituency')
    // retrieve the features so that we can access the id
        .data(topojson.feature(topology, topology.objects.constituencies).features)
        .enter().append('path')
        .attr('class', function(d) { return 'constituency ' + d.id; })
        // added for color codes:
        .attr("class", function(d) { return quantize(resultsById.get(d.id)); })
        .attr('d', path)
        ;
});

        </script>
    </body>
</html>
